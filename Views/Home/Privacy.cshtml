@model V1MentionsResponse

@{
    ViewData["Title"] = "V1 Posts";
}

<style>
    tr { height: 45px; }
    td, th { vertical-align: middle; }
    th { white-space: nowrap; }
    .row .btn { padding: 10px 20px 10px 20px; }
    .datepicker, .form-control { padding: 10px; }
    img { height: 30px; }
    body > div.datepicker.datepicker-dropdown.dropdown-menu.datepicker-orient-left.datepicker-orient-bottom > div.datepicker-days > table > thead > tr,
    body > div.datepicker.datepicker-dropdown.dropdown-menu.datepicker-orient-left.datepicker-orient-bottom > div.datepicker-days > table > tfoot > tr {
        height: 5px;
    }
    body > div.datepicker.datepicker-dropdown.dropdown-menu.datepicker-orient-left.datepicker-orient-bottom > div.datepicker-days > table {
        margin: 8px 24px 8px 24px;
    }
</style>

<h1>Determ posts</h1>
<div class="container-fluid">
    <form id="filterForm">
        <div class="row">
            <div class="col-md-3 mb-3">
                <label for="fromDate">From Date</label>
                <input type="text" class="form-control datepicker" id="fromDate" name="fromDate" />
            </div>
            <div class="col-md-3 mb-3">
                <label for="toDate">To Date</label>
                <input type="text" class="form-control datepicker" id="toDate" name="toDate" />
            </div>
            <div class="col-md-3 mb-3">
                <label for="count">Post Count</label>
                <input type="text" class="form-control" id="count" name="count" />
            </div>
            <div class="col-md-3 mb-3">
                <label>&nbsp;</label>
                <button type="button" class="btn btn-primary" onclick="updateTable()">Apply Filters</button>
            </div>
        </div>
    </form>

    <div class="tab-view">
    <ul class="nav nav-tabs" id="postsTabs">
        <li class="nav-item">
            <a class="nav-link active" id="v1Tab" data-toggle="tab" href="#v1">V1</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="v2Tab" data-toggle="tab" href="#v2">V2</a>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="v1">
            <p>Post count: @Model.Data.Response.Count</p>

            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Thumbnail</th>
                            <th>Title</th>
                            <th>Insert Time</th>
                            <th>Type</th>
                            <th>From</th>
                            <th>URL</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var post in Model.Data.Response)
                        {
                        <tr>
                            <td>@post.Id</td>
                            <td class="text-center"><img src="@post.Image" alt="N/A" /></td>
                            <td class="text-truncate" style="max-width: 200px;">@post.Title</td>
                            <td>@post.Type</td>
                            <td style="white-space: nowrap;">
                                @DateTimeOffset.FromUnixTimeSeconds(post.InsertTime).LocalDateTime.ToString("yyyy-MM-dd HH:mm:ss")</td>
                            <td>@post.From</td>
                            <td class="text-truncate"><a href="@post.Url" target="_blank">@post.Url</a></td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="tab-pane fade" id="v2">
            <!-- Table content for V2 -->
            <p>Post count: @Model.Data.Response.Count</p>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Thumbnail</th>
                            <th>Title</th>
                            <th>Insert Time</th>
                            <th>Type</th>
                            <th>From</th>
                            <th>URL</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var post in Model.Data.Response)
                        {
                        <tr>
                            <td>@post.Id</td>
                            <td class="text-center"><img src="@post.Image" alt="N/A" /></td>
                            <td class="text-truncate" style="max-width: 200px;">@post.Title</td>
                            <td>@post.Type</td>
                            <td style="white-space: nowrap;">
                                @DateTimeOffset.FromUnixTimeSeconds(post.InsertTime).LocalDateTime.ToString("yyyy-MM-dd HH:mm:ss")</td>
                            <td>@post.From</td>
                            <td class="text-truncate"><a href="@post.Url" target="_blank">@post.Url</a></td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    </div>

</div>

@section Scripts {
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <script>
        $(document).ready(function () {
            // Preload From Date with two weeks ago
            var twoWeeksAgo = new Date();
            twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
            $('#fromDate').datepicker('setDate', twoWeeksAgo);

            // Preload To Date with today's date
            var today = new Date();
            $('#toDate').datepicker('setDate', today);

            // Preload Post Count with 100
            $('#count').val(100);

            // Initialize datepicker
            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true
            });

              // Fetch and update data after the page has loaded
            @* fetchDataAndUpdateTable(); *@
        });

        function updateTable() {
            // Retrieve filter values
            var fromDate = $('#fromDate').val();
            var toDate = $('#toDate').val();
            var count = $('#count').val();

            // Convert date values to Unix timestamps
            var fromTimestamp = Math.floor(new Date(fromDate).getTime() / 1000);
            var toTimestamp = Math.floor(new Date(toDate).getTime() / 1000);

            // Make an AJAX request to the server
            $.ajax({
                url: '@Url.Action("Privacy", "Home")', // URL to the Privacy action
                type: 'POST',
                data: { from: fromTimestamp, to: toTimestamp, count: count },
                success: function (data) {
                    // Update the table body with the new content
                    $('#v1 tbody').html($(data).find('#v1 tbody').html());
                    $('#v2 tbody').html($(data).find('#v2 tbody').html());

                    // Update other elements if needed

                    // Additional actions after updating the table
                    console.log("Table updated successfully");
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }
    </script>
}